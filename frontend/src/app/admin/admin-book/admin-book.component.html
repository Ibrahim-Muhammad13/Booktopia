<h1 class="p-2">Admin Books</h1>
<div class="container">
  <div class="row">
    <div class="table-container">
      <form #autherbookForm="ngForm" (ngSubmit)="submitBookForm(autherbookForm)">

        <table class="table">
          <thead>
            <tr>
              <th scope="col">Book Name</th>
              <th scope="col" *ngIf="showForm">Rate</th>
              <th scope="col" *ngIf="showForm">Author Name</th>
              <th scope="col" *ngIf="showForm">Category Name</th>
              <th scope="col">Action</th>
              <th scope="col" class="d-flex justify-content-end">
                <button type="button" class="btn btn-success" (click)="showForm=true; isNewBook=true">Add</button>
              </th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="showForm; else bookList">
              <tr>

                <td>
                  <input type="text" class="form-control" aria-describedby="BookNameHelp" name="adminBookName" ngModel
                    #adminBookName="ngModel" minlength="8" required />
                  <div id="BookNameHelp" class="form-text text-danger"
                    *ngIf="adminBookName.touched && adminBookName.invalid">
                    <span *ngIf="adminBookName?.errors?.['required']">This Field Is Required</span>
                    <span *ngIf="adminBookName?.errors?.['minlength']">the minlength is 8 character</span>
                  </div>
                </td>

                <td>
                  <input type="number" class="form-control" aria-describedby="BookRateHelp" name="bookRate" ngModel
                    #bookRate="ngModel" required />
                  <div id="BookRateHelp" class="form-text text-danger" *ngIf="bookRate.touched && bookRate.invalid">
                    <span *ngIf="bookRate?.errors?.['required']">This Field Is Required</span>
                  </div>
                </td>

                <td>
                  <select class="form-select" aria-describedby="authorBookHelp" name="authorbook" ngModel
                    #authorbook="ngModel" required>
                    <option selected>Choose Your Auther Name</option>
                    <option *ngFor="let auther of authers" value="{{ auther._id }}">
                      {{ auther.firstName }} {{ auther.LastName }}
                    </option>
                  </select>
                  <div id="authorBookHelp" class="form-text text-danger"
                    *ngIf="authorbook.touched && authorbook.invalid">
                    <span *ngIf="authorbook?.errors?.['required']">This Field Is Required</span>
                  </div>
                </td>

                <td>
                  <select name="categoryId" class="form-select" aaria-describedby="authorcategoryHelp" ngModel
                    #categoryId="ngModel" required>
                    <option selected>Choose Your Category Name</option>
                    <option *ngFor="let category of categories" value="{{ category._id }}">
                      {{ category.cat_Name }}
                    </option>
                  </select>
                  <div id="authorcategoryHelp" class="form-text text-danger"
                    *ngIf="categoryId.touched && categoryId.invalid">
                    <span *ngIf="categoryId?.errors?.['required']">This Field Is Required</span>
                  </div>
                </td>

                <td>
                  <ng-container *ngIf="isNewBook">
                    <button (click)="addBook()" type="submit" class="btn btn-primary me-3"
                      [disabled]="autherbookForm.invalid && autherbookForm.touched">Save</button>
                  </ng-container>
                  <ng-container *ngIf="!isNewBook">
                    <button type="button" class="btn btn-primary me-1"
                      [disabled]="autherbookForm.invalid && autherbookForm.touched"
                      (click)="selectedBook && updateBook(selectedBook._id, newBookName, selectedBook.rate, selectedBook.authorId, selectedBook.categoryId)">Update</button>
                  </ng-container>
                  <button type="button" class="btn btn-danger" (click)="cancelForm()">Cancel</button>
                </td>
              </tr>
            </ng-container>

            <ng-template #bookList>
              <tr *ngFor="let book of books; let i = index">
                <td scope="row">{{book.name}}</td>
                <td>
                  <button type="button" class="btn btn-primary me-4" (click)="editBook(book)">Edit</button>
                  <button type="button" class="btn btn-danger" (click)="deleteBook(book._id, i)">Delete</button>
                </td>
              </tr>
            </ng-template>
          </tbody>
        </table>
      </form>
    </div>
  </div>
</div>